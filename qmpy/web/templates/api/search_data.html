{% load crispy_forms_tags %}
{% load admin_static %}
<!DOCTYPE html>
<html>
<head>
    <link href="{% static "css/bootstrap.min.css" %}" rel="stylesheet" />

    <script src="http://code.jquery.com/jquery-1.9.1.js">
    </script>
    <script src="http://code.jquery.com/ui/1.11.0/jquery-ui.js">
    </script>
    <script type="text/javascript" src="{% static "js/bootstrap-tab.js" %}"></script>
</head>

<style>
table {
    border-spacing: 0;
    width: 100%;
    border: 1px solid #ddd;
}

th {
    cursor: pointer;
}
                                                                
th, td {
    text-align: center;
    padding: 16px;
}

tr {
    line-height: 5px;
    min-height: 5px;
    height: 5px;
}

tr:nth-child(even) {
    background-color: #f2f2f2
}

.clickableRow td:hover {
    cursor: pointer;
}

button {
    text-decoration: none;
    display: inline-block;
    padding: 4px 8px;
}

button:hover:not([disabled]) {
    background-color: #4CAF50;
    color: white;
}

.prev {
    background-color: #f1f1f1;
    color: black;
}

.next {
    background-color: #f1f1f1;
    color: black;
}

.clear {
    background-color: #f1f1f1;
    color: black;
}

.disabled {
    background-color: #f1f1f1;
    color: grey;
}


</style>
<body>

<h1> Search OQMD </h1>
<div style="margin: 10px">
    <a href="/" class="button">Return to OQMD Home</a>
</div>

{% crispy form %}
{% if result %}
<h1> Results: </h1>
<div style="margin: 10px">
    <p>
    <font size="3">
    There are <b>{{count}}</b> entries found.
    </font>
    {% if sort_by %}
    <i>(Sorted by {{ sort_by }}) </i>
    {% endif %}
    </p>
    <form action="" method="POST">{% csrf_token %}
        <button class="prev" type="submit" value="{{request_post}}" name="front">
            &lt;&lt;
        </button>
        {% if prev %}
        <button class="prev" type="submit" value="{{request_post}}" name="prev">
            &lt;
        </button>
        {% else %} 
        <button class="prev" type="button" disabled>
            &lt;
        </button>
        {% endif %}
        {{ start }} - {{ end }}
        {% if next %}
        <button class="next" type="submit" value="{{request_post}}" name="next">
            &gt;
        </button>
        {% else %} 
        <button class="next" type="button" disabled>
            &gt;
        </button>
        {% endif %}
        <button class="next" type="submit" value="{{request_post}}" name="end">
            &gt;&gt;
        </button>
        <button class="clear" type="submit" name="clear">
            Clear Results
        </button>
    </form>
</div>
<table id="ResultTable">
    <tr>
        <th onclick="sortTable(0, 'num')"> rank </th>
        <th onclick="sortTable(1, 'num')"> oqmd_id </th>
        <th onclick="sortTable(2, 'num')"> icsd_id </th>
        <th onclick="sortTable(3, 'link')"> name </th>
        <th onclick="sortTable(4, 'str')"> generic </th>
        <th onclick="sortTable(5, 'str')"> spacegroup </th>
        <th onclick="sortTable(6, 'str')"> prototype </th>
        <th onclick="sortTable(7, 'num')"> ntypes </th>
        <th onclick="sortTable(8, 'num')"> natoms </th>
        <th onclick="sortTable(9, 'num')"> volume </th>
        <th onclick="sortTable(10, 'num')"> formation_energy </th>
        <th onclick="sortTable(11, 'num')"> band_gap </th>
        <th onclick="sortTable(12, 'num')"> stability </th>
    </tr>
    {% for e in result %}
        <tr class=clickableRow">
        <td width="60"> {{ forloop.counter|add:offset}} </td>
        <td width="60"> {{ e.entry_id }} </td>

        {% if e.icsd_id %}
            <td width="60"> {{ e.icsd_id }} </td>
        {% else %}
            <td width="60">  </td>
        {% endif %}

        <td width="90"> <a href="/materials/entry/{{e.entry_id}}">{{ e.name }}</a></td>
        <td width="80"> {{ e.composition_generic }} </td>
        <td width="80"> {{ e.spacegroup }} </td>
        <td width="80"> {{ e.prototype }} </td>

        {% if e.ntypes %}
            <td width="80"> {{ e.ntypes }} </td>
        {% else %}
            <td width="80"> </td>
        {% endif %}

        {% if e.natoms %}
            <td width="80"> {{ e.natoms }} </td>
        {% else %}
            <td width="80"> </td>
        {% endif %}
        
        <td width="80"> {{ e.volume | floatformat:-3 }} </td>
        <td width="80"> {{ e.delta_e | floatformat:-3 }} </td>
        <td width="80"> {{ e.band_gap | floatformat:-3 }} </td>
        <td width="80"> {{ e.stability | floatformat:-3 }} </td>
        </tr>
    {% endfor %}
</table>
<div style="margin: 10px">
    <a href="/oqmdapi/formationenergy?{{suburl}}&format=json" class="button">Output Result in JSON format</a>
</div>
{% endif %}


<!-- The following function is from www.w3cshools.com/
    Section: 'How TO - Sort a Table'
    The link is https://www.w3schools.com/howto/howto_js_sort_table.asp
-->
<script>
function sortTable(n, type) {
    var table, rows, switching, i, x, y, xc, yc, shouldSwitch, dir, switchcount = 0;
    table = document.getElementById('ResultTable');
    switching = true;

    dir = "asc";

    while (switching) {
        switching = false;
        rows = table.rows;

        for (i = 1; i < (rows.length - 1); i++) {
            shouldswitch = false;

            x = rows[i].getElementsByTagName("TD")[n];
            y = rows[i + 1].getElementsByTagName("TD")[n];

            if (type == 'num') {
                xc = Number(x.innerHTML)
                yc = Number(y.innerHTML)
            } else if (type == 'str') {
                xc = x.innerHTML.toLowerCase()
                yc = y.innerHTML.toLowerCase()
            } else if (type == 'link') {
                xc = x.innerText.toLowerCase()
                yc = y.innerText.toLowerCase()
            }


            if (dir == "asc") {
                if (xc > yc){
                    shouldSwitch = true;
                    break;
                }
            } else if (dir == "desc") {
                if (xc < yc){
                    shouldSwitch = true;
                    break;
                }
            }
        }

        if (shouldSwitch) {
            rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
            switching = true;
            switchcount ++;
        } else {
            if (switchcount == 0 && dir == "asc") {
                dir = "desc";
                switching = true;
            }
        }
    }
}
</script>

</body>

</html>

